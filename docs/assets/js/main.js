"use strict";const searchInput=document.querySelector(".js_searchInput"),searchBtn=document.querySelector(".js_searchBtn"),resetBtn=document.querySelector(".js_resetBtn"),resultUl=document.querySelector(".js_resultUl"),favouriteUl=document.querySelector(".js_favouriteUl"),deleteFavBtn=document.querySelector(".js_deleteFavBtn"),msgSearch=document.querySelector(".js_msgSearch"),headerImg=document.querySelector(".js_headerImg"),msgBubble=document.querySelector(".js_bubble"),logBtn=document.querySelector(".js_logBtn"),Urlchange="https://via.placeholder.com/80x110/C05340/272524/?text=SIN IMAGEN";let results=[],favourites=[];const renderAnimeFav=()=>{let e="";for(const t of favourites)e+=`<li class="js_liFav liFav" id="${t.id}">`,"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"!==t.img?e+=`<img src="${t.img}" alt="Imagen del anime ${t.title}" class="imgFav">`:e+=`<img src=${Urlchange} alt="No hay imagen disponible" class="imgFav">`,e+='<div class="divFavourites">',e+=`<h2 class="h2Fav">${t.title}</h2>`,e+=`<i class="fa-solid fa-2x fa-circle-xmark js_iconRemove iconFav" id="${t.title}"></i>`,e+="</div></li>";favouriteUl.innerHTML=e,listenerAnime(),listenerIconFav(),localStorage.setItem("favouritesLS",JSON.stringify(favourites))},renderAnimeResult=()=>{let e="",t="";for(const n of results){t=-1!==favourites.findIndex(e=>n.id===e.id)?"favourite":"",e+=`<li class="js_liAnime ${t} liResults" id="${n.id}">`,"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"!==n.img?e+=`<img src="${n.img}" alt="Imagen del anime ${n.title}" class="imgRes">`:e+=`<img src=${Urlchange}  alt="No hay imagen disponible" class="imgRes">`,e+=`<h2 class="${t}__title" h2Res>${n.title}</h2>`,e+="</li>"}resultUl.innerHTML=e,listenerAnime(),listenerIconFav()},getDataApi=()=>{const e=searchInput.value;fetch("https://api.jikan.moe/v4/anime?q="+e).then(e=>e.json()).then(e=>{results=e.data.map((function(e){return{img:e.images.jpg.image_url,title:e.title,id:e.mal_id,score:e.score}})),msgSearch.classList.add("hidden"),renderAnimeResult()})};function handleLog(){event.preventDefault(),console.log(favourites.length)}function handleBubble(){msgBubble.classList.toggle("hidden")}function handleBtnReset(e){e.preventDefault(),searchInput.value="",resultUl.innerHTML=""}function handleDeleteAllFav(e){e.preventDefault(),favourites.splice(0,favourites.length),renderAnimeFav(),""!==resultUl.innerHTML&&renderAnimeResult()}function handleRemoveFav(e){const t=e.currentTarget.id,n=favourites.findIndex(e=>e.title===t);favourites.splice(n,1),renderAnimeFav(),""!==resultUl.innerHTML&&renderAnimeResult()}function handleAddFav(e){const t=parseInt(e.currentTarget.id),n=results.find(e=>e.id===t),i=favourites.findIndex(e=>e.id===t);-1===i?favourites.push(n):favourites.splice(i,1),renderAnimeFav(),renderAnimeResult()}function handleClickSearch(e){e.preventDefault(),""===searchInput.value?(msgSearch.classList.remove("hidden"),resultUl.innerHTML=""):getDataApi()}logBtn.addEventListener("click",handleLog),headerImg.addEventListener("click",handleBubble),resetBtn.addEventListener("click",handleBtnReset),deleteFavBtn.addEventListener("click",handleDeleteAllFav);const listenerIconFav=()=>{const e=document.querySelectorAll(".js_iconRemove");for(const t of e)t.addEventListener("click",handleRemoveFav)},listenerAnime=()=>{const e=document.querySelectorAll(".js_liAnime");for(const t of e)t.addEventListener("click",handleAddFav)};searchBtn.addEventListener("click",handleClickSearch);const loadPage=()=>{const e=JSON.parse(localStorage.getItem("favouritesLS"));e&&(favourites=e,renderAnimeFav())};loadPage();